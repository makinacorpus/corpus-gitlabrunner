#!/usr/bin/env bash
. $GRUNNER_TOP_DIR/bin/shell_common

TEST_LXC_HOST="${TEST_LXC_HOST:-"localhost"}"
TEST_LXC_TEMPLATE=${TEST_LXC_TEMPLATE:-gitlabrunner-common}
TEST_LXC_PATH=${TEST_LXC_PATH:-/var/lib/lxc}
TEST_LXC_NAME=${TEST_LXC_NAME:-${LXCNAME:-gci-$(get_random_slug 8)}}
TEST_LXC_BUILD_SCRIPT=${TEST_LXC_BUILD_SCRIPT:-${GRUNNER_TOP_DIR}/bin/lxc_build.sh}
TEST_LXC_TEST_SCRIPT=${TEST_LXC_TEST_SCRIPT:-${GRUNNER_TOP_DIR}/bin/lxc_test.sh}
TEST_LXC_CLEANUP_SCRIPT=${TEST_LXC_CLEANUP_SCRIPT:-${GRUNNER_TOP_DIR}/bin/lxc_cleanup.sh}
TEST_LXC_BACKING_STORE=${TEST_LXC_BACKING_STORE:-overlayfs}
ANSIBLE_INV=${LXC_ANSIBLE_INV:-"-i $TEST_ORIGIN,$TEST_LXC_HOST,"}

get_ansible_hosts() {
    echo "$TEST_ORIGIN" "${TEST_LXC_HOST}"
}

PROJECT_TEST_PLAYBOOK_FOLDERS="
$W/ansible/playbooks/tests
$W/.ansible/playbooks/tests"

DEFAULT_TEST_LXC_CREATE_PLAYBOOKS="$(first_found_file create.yml \
    "$PROJECT_TEST_PLAYBOOK_FOLDERS" \
    "$GRUNNER_TOP_DIR/ansible/playbooks/lxc")"
TEST_LXC_CREATE_PLAYBOOKS=${TEST_LXC_CREATE_PLAYBOOKS-${DEFAULT_TEST_LXC_CREATE_PLAYBOOKS}}

DEFAULT_TEST_LXC_CLEANUP_PLAYBOOKS="$(first_found_file cleanup.yml \
    "$PROJECT_TEST_PLAYBOOK_FOLDERS" \
    "$GRUNNER_TOP_DIR/ansible/playbooks/lxc")"
TEST_LXC_CLEANUP_PLAYBOOKS=${TEST_LXC_CLEANUP_PLAYBOOKS-${DEFAULT_TEST_LXC_CLEANUP_PLAYBOOKS}}

DEFAULT_TEST_LXC_SYNC_CODE_PLAYBOOKS="$(first_found_file sync_code.yml \
    "$PROJECT_TEST_PLAYBOOK_FOLDERS" \
    "$GRUNNER_TOP_DIR/ansible/playbooks/lxc/lifecycle")"
TEST_LXC_SYNC_CODE_PLAYBOOKS=${TEST_LXC_SYNC_CODE_PLAYBOOKS-${DEFAULT_TEST_LXC_SYNC_CODE_PLAYBOOKS}}

DEFAULT_TEST_LXC_SETUP_PLAYBOOKS="$(first_found_file setup.yml \
    "$PROJECT_TEST_PLAYBOOK_FOLDERS" \
    "$GRUNNER_TOP_DIR/ansible/playbooks/lxc/lifecycle")"
TEST_LXC_SETUP_PLAYBOOKS=${TEST_LXC_SETUP_PLAYBOOKS-${DEFAULT_TEST_LXC_SETUP_PLAYBOOKS}}

DEFAULT_TEST_LXC_TEST_PLAYBOOKS="$(first_found_file test.yml \
    "$PROJECT_TEST_PLAYBOOK_FOLDERS" \
    "$GRUNNER_TOP_DIR/ansible/playbooks/lxc/lifecycle")"
TEST_LXC_TEST_PLAYBOOKS=${TEST_LXC_TEST_PLAYBOOKS-${DEFAULT_TEST_LXC_TEST_PLAYBOOKS}}

re_export_vars
# vim:set et sts=4 ts=4 tw=0:
